<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Provider Enrollment Form</title>
<style>
body { 
  font-family: 'Segoe UI', sans-serif; 
  background: #f5f7fa; 
  padding: 24px; 
}
form { 
  width: 50%; 
  margin: auto; 
}
.card { 
  background: #fff; 
  border-radius: 10px; 
  padding: 18px; 
  margin: 14px 0; 
  box-shadow: 0 3px 8px rgba(0,0,0,.08);
}
label { 
  display:block; 
  font-weight:600; 
  margin-bottom:6px;
}
input, textarea { 
  width:100%; 
  padding:10px; 
  border:1px solid #ccc; 
  border-radius:6px; 
  box-sizing:border-box;
}
.add-btn { 
  background:#009688; 
  color:#fff; 
  border:none; 
  padding:8px 12px; 
  border-radius:6px; 
  cursor:pointer;
}
button[type=submit]{ 
  background:#007bff; 
  color:#fff; 
  padding:12px 20px; 
  border:none; 
  border-radius:8px; 
  cursor:pointer; 
  font-size:16px;
}
.owner-only { display:none; }
.required-star { color: red; }

/* Messages */
#loadingMessage, #successMessage, #errorMessage {
  display:none; 
  margin:20px; 
  padding:15px; 
  border-radius:8px; 
  text-align:center; 
  font-size:16px;
}
#successMessage { background:#d4edda; color:#155724; }
#errorMessage { background:#f8d7da; color:#721c24; }

/* Loader overlay */
#loadingMessage {
  display:none;   /* default hidden */
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.8);
  backdrop-filter: blur(2px);
  z-index: 9999;

  align-items:center;
  justify-content:center;
  font-size:20px;
  font-weight:600;
  color:#856404;
}

/* Radio alignment */
.radio-group {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.radio-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
}
.option-text {
  flex: 1;
  text-align: left;
}
.radio-box {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}
.radio-option input[type="radio"] {
  margin: 0;
}

/* Row layout */
.row {
  display: flex;
  gap: 16px;
}
.row label {
  flex: 1;
}
</style>
</head>
<body>

<h2 style="text-align:center;">Provider Enrollment Form</h2>

<div id="loadingMessage">⏳ Please wait, your submission is being processed...</div>
<div id="successMessage">✅ Thank you for your submission. One of our enrollment specialists will begin processing your form and contact you if we need more information.</div>
<div id="errorMessage">❌ Something went wrong. Please try again.</div>

<form id="enrollmentForm" method="post" enctype="multipart/form-data">
  <div class="card">
    <h3>Select Role<span class="required-star">*</span></h3>
    <div class="radio-group">
      <label class="radio-option">
        <span class="option-text">Provider joining a group practice</span>
        <span class="radio-box"><input type="radio" name="role" value="provider" required></span>
      </label>
      <label class="radio-option">
        <span class="option-text">Owner of a practice</span>
        <span class="radio-box"><input type="radio" name="role" value="owner" required></span>
      </label>
    </div>
  </div>

  <!-- Practice Info -->
  <div id="practiceSection" style="display:none;">
    <div class="card">
      <h3>Practice Information</h3>
      <label>Practice Name<span class="required-star">*</span><input name="practiceName" required></label>

      <div class="row">
        <label>Practice Contact First Name<input name="practiceContactFirstName"></label>
        <label>Practice Contact Last Name<input name="practiceContactLastName"></label>
      </div>

      <div class="row">
        <label>Email<input type="email" name="practiceContactEmail"></label>
        <label>Phone<input name="practiceContactPhone"></label>
      </div>

      <label>Service Location(s)<span class="required-star">*</span></label>
      <div id="serviceLocations">
        <input name="serviceLocation[]" required>
      </div>
      <button type="button" class="add-btn" onclick="addServiceLocation()">+ Add Another Location</button>

      <!-- Owner-only fields -->
      <label class="owner-only">Billing Address<input name="billingAddress"></label>
      <label class="owner-only">Tax ID<span class="required-star">*</span><input name="taxId"></label>
      <label class="owner-only">Group NPI<input name="groupNpi"></label>
      <label class="owner-only">Group Medicare PTAN/ID<input name="groupMedicare"></label>
      <label class="owner-only">Group Medicaid ID<input name="groupMedicaid"></label>

      <label>Counties you are seeing patients of<input name="counties"></label>
      <label>Office Phone<span class="required-star">*</span><input name="officePhone"></label>
      <label>FAX<input name="fax"></label>
    </div>
  </div>

  <!-- Provider Info -->
  <div id="providerSection" style="display:none;">
    <div class="card">
      <h3>Provider Information</h3>

      <div class="row">
        <label>First Name<span class="required-star">*</span><input name="providerFirstName" required></label>
        <label>Middle Initial<input name="providerMiddleInitial"></label>
        <label>Last Name<span class="required-star">*</span><input name="providerLastName" required></label>
      </div>

      <label>Individual NPI<input name="individualNpi"></label>
      <label>Medicare ID<input name="individualMedicare"></label>
      <label>Medicaid ID<input name="individualMedicaid"></label>
      <label>SSN<span class="required-star">*</span><input name="ssn" required></label>
      <label>DOB<span class="required-star">*</span><input type="date" name="dob" required></label>
      <label>License<span class="required-star">*</span><input name="license" required></label>
      <label>CAQH ID<input name="caqhId"></label>

      <div class="row">
        <label>Email<span class="required-star">*</span><input type="email" name="email" required></label>
        <label>Cell<input name="cell"></label>
      </div>

      <label>Home Address<span class="required-star">*</span><input name="homeAddress" required></label>
      <label>Taxonomy<input name="taxonomy"></label>
      <label>Specialty<input name="specialty"></label>
      <label>Languages Spoken<input name="languages"></label>
    </div>

    <div class="card">
      <h3>Logins</h3>
      <div class="row">
        <label>PECOS Username<input name="pecosLogin"></label>
        <label>PECOS Password<input type="password" name="pecosPassword"></label>
      </div>
      <div class="row">
        <label>CAQH Username<input name="caqhLogin"></label>
        <label>CAQH Password<input type="password" name="caqhPassword"></label>
      </div>
    </div>

    <div class="card">
      <h3>Documents Upload</h3>
      <label>Copy of License<span class="required-star">*</span><input type="file" name="licenseFile" required></label>
      <label>Copy of Educational Degree<span class="required-star">*</span><input type="file" name="degreeFile" required></label>
      <label>Copy of Malpractice<input type="file" name="malpracticeFile"></label>
      <label>Resume<span class="required-star">*</span><input type="file" name="resumeFile" required></label>
      <label class="owner-only">W9 Form<input type="file" name="w9File"></label>
      <label class="owner-only">Voided Check<input type="file" name="checkFile"></label>
      <label class="owner-only">Copy of IRS Letter<input type="file" name="irsFile"></label>
    </div>

    <div class="card">
      <h3>Special Instructions</h3>
      <label>Notes for Credentialing Team<textarea name="specialInstructions" rows="4"></textarea></label>
    </div>
  </div>

  <button type="submit">Submit</button>
</form>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycbzeT9gewu_K01avi8hgdxomRpHvuS8M3oyqjwAHxQb9DJwjbKTGZgNJdJ442oONnHYZbw/exec";

document.querySelectorAll('input[name="role"]').forEach(radio => {
  radio.addEventListener('change', e => {
    document.getElementById('practiceSection').style.display = 'block';
    document.getElementById('providerSection').style.display = 'block';
    document.querySelectorAll('.owner-only').forEach(f => {
      f.style.display = e.target.value === 'owner' ? 'block' : 'none';
      if(e.target.value === 'owner') {
        f.querySelector("input")?.setAttribute("required", true);
      } else {
        f.querySelector("input")?.removeAttribute("required");
      }
    });
  });
});

function addServiceLocation() {
  const div = document.createElement("div");
  div.innerHTML = `<input name="serviceLocation[]" placeholder="Additional Service Location">`;
  document.getElementById("serviceLocations").appendChild(div);
}

document.getElementById('enrollmentForm').addEventListener('submit', function(e){
  e.preventDefault();
  const form = e.target;

  if(!form.checkValidity()){
    alert("⚠️ Please complete all required fields before submitting.");
    return;
  }

  document.getElementById("loadingMessage").style.display = "flex"; // show loader
  document.getElementById("successMessage").style.display = "none";
  document.getElementById("errorMessage").style.display = "none";

  const data = {};
  const files = {};

  [...form.elements].forEach(el => {
    if(el.name){
      if(el.type==='file' && el.files.length){
        for(let f of el.files){
          const reader = new FileReader();
          reader.onload = evt => { 
            files[f.name] = {name:f.name, type:f.type, content:evt.target.result.split(',')[1]}; 
          };
          reader.readAsDataURL(f);
        }
      } else if(el.name.endsWith('[]')){
        if(!data[el.name]) data[el.name] = [];
        if(el.value.trim() !== "") data[el.name].push(el.value);
      } else {
        data[el.name] = el.value;
      }
    }
  });

  setTimeout(() => {
    data.files = files;
    fetch(webAppUrl, {
      method:'POST',
      body:JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      document.getElementById("loadingMessage").style.display = "none"; // hide loader
      if(res.status === 'success'){
        form.reset();
        form.style.display = 'none';
        document.getElementById("successMessage").style.display = 'block';
      } else {
        document.getElementById("errorMessage").style.display = "block";
      }
    })
    .catch(() => {
      document.getElementById("loadingMessage").style.display = "none"; // hide loader
      document.getElementById("errorMessage").style.display = "block";
    });
  }, 1000);
});
</script>

</body>
</html>
